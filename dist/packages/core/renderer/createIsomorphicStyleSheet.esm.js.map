{"version":3,"file":"createIsomorphicStyleSheet.esm.js","sources":["../../../../packages/core/src/renderer/createIsomorphicStyleSheet.ts"],"sourcesContent":["import { DATA_BUCKET_ATTR } from '../constants';\nimport { IsomorphicStyleSheet, StyleBucketName } from '../types';\n\nexport function createIsomorphicStyleSheet(\n  styleElement: HTMLStyleElement | undefined,\n  bucketName: StyleBucketName,\n  elementAttributes: Record<string, string>,\n  constructableStylesheets: boolean,\n): IsomorphicStyleSheet {\n  // no CSSStyleSheet in SSR, just append rules here for server render\n  const __cssRulesForSSR: string[] = [];\n\n  elementAttributes[DATA_BUCKET_ATTR] = bucketName;\n  if (styleElement) {\n    for (const attrName in elementAttributes) {\n      styleElement.setAttribute(attrName, elementAttributes[attrName]);\n    }\n  }\n\n  let sheet: CSSStyleSheet;\n  function insertRule(rule: string) {\n    if (constructableStylesheets) {\n      if (!sheet) {\n        sheet = new CSSStyleSheet();\n        // @ts-expect-error\n        sheet.replaceSync(rule);\n        // @ts-expect-error\n        document.adoptedStyleSheets = [...document.adoptedStyleSheets, sheet];\n      } else {\n        sheet.insertRule(rule, sheet.cssRules.length);\n      }\n      return sheet.cssRules.length;\n    } else if (styleElement?.sheet) {\n      return styleElement.sheet.insertRule(rule, styleElement.sheet.cssRules.length);\n    }\n\n    return __cssRulesForSSR.push(rule);\n  }\n\n  return {\n    elementAttributes,\n    insertRule,\n    element: styleElement,\n    bucketName,\n    cssRules() {\n      if (constructableStylesheets) {\n        return Array.from(sheet.cssRules).map(cssRule => cssRule.cssText);\n      } else if (styleElement?.sheet) {\n        return Array.from(styleElement.sheet.cssRules).map(cssRule => cssRule.cssText);\n      }\n\n      return __cssRulesForSSR;\n    },\n  };\n}\n\nexport function createIsomorphicStyleSheetFromElement(element: HTMLStyleElement) {\n  const elementAttributes = Array.from(element.attributes).reduce((acc, attr) => {\n    acc[attr.name] = attr.value;\n    return acc;\n  }, {} as Record<string, string>);\n  const stylesheet = createIsomorphicStyleSheet(\n    element,\n    elementAttributes[DATA_BUCKET_ATTR] as StyleBucketName,\n    elementAttributes,\n    false,\n  );\n  return stylesheet;\n}\n"],"names":["createIsomorphicStyleSheet","styleElement","bucketName","elementAttributes","constructableStylesheets","__cssRulesForSSR","DATA_BUCKET_ATTR","attrName","setAttribute","sheet","insertRule","rule","CSSStyleSheet","replaceSync","document","adoptedStyleSheets","cssRules","length","push","element","Array","from","map","cssRule","cssText","createIsomorphicStyleSheetFromElement","attributes","reduce","acc","attr","name","value","stylesheet"],"mappings":";;SAGgBA,2BACdC,cACAC,YACAC,mBACAC;;EAGA,MAAMC,gBAAgB,GAAa,EAAnC;EAEAF,iBAAiB,CAACG,gBAAD,CAAjB,GAAsCJ,UAAtC;;EACA,IAAID,YAAJ,EAAkB;IAChB,KAAK,MAAMM,QAAX,IAAuBJ,iBAAvB,EAA0C;MACxCF,YAAY,CAACO,YAAb,CAA0BD,QAA1B,EAAoCJ,iBAAiB,CAACI,QAAD,CAArD;;;;EAIJ,IAAIE,KAAJ;;EACA,SAASC,UAAT,CAAoBC,IAApB;IACE,IAAIP,wBAAJ,EAA8B;MAC5B,IAAI,CAACK,KAAL,EAAY;QACVA,KAAK,GAAG,IAAIG,aAAJ,EAAR,CADU;;QAGVH,KAAK,CAACI,WAAN,CAAkBF,IAAlB,EAHU;;QAKVG,QAAQ,CAACC,kBAAT,GAA8B,CAAC,GAAGD,QAAQ,CAACC,kBAAb,EAAiCN,KAAjC,CAA9B;OALF,MAMO;QACLA,KAAK,CAACC,UAAN,CAAiBC,IAAjB,EAAuBF,KAAK,CAACO,QAAN,CAAeC,MAAtC;;;MAEF,OAAOR,KAAK,CAACO,QAAN,CAAeC,MAAtB;KAVF,MAWO,IAAIhB,YAAY,SAAZ,IAAAA,YAAY,WAAZ,SAAA,GAAAA,YAAY,CAAEQ,KAAlB,EAAyB;MAC9B,OAAOR,YAAY,CAACQ,KAAb,CAAmBC,UAAnB,CAA8BC,IAA9B,EAAoCV,YAAY,CAACQ,KAAb,CAAmBO,QAAnB,CAA4BC,MAAhE,CAAP;;;IAGF,OAAOZ,gBAAgB,CAACa,IAAjB,CAAsBP,IAAtB,CAAP;;;EAGF,OAAO;IACLR,iBADK;IAELO,UAFK;IAGLS,OAAO,EAAElB,YAHJ;IAILC,UAJK;;IAKLc,QAAQ;MACN,IAAIZ,wBAAJ,EAA8B;QAC5B,OAAOgB,KAAK,CAACC,IAAN,CAAWZ,KAAK,CAACO,QAAjB,EAA2BM,GAA3B,CAA+BC,OAAO,IAAIA,OAAO,CAACC,OAAlD,CAAP;OADF,MAEO,IAAIvB,YAAY,SAAZ,IAAAA,YAAY,WAAZ,SAAA,GAAAA,YAAY,CAAEQ,KAAlB,EAAyB;QAC9B,OAAOW,KAAK,CAACC,IAAN,CAAWpB,YAAY,CAACQ,KAAb,CAAmBO,QAA9B,EAAwCM,GAAxC,CAA4CC,OAAO,IAAIA,OAAO,CAACC,OAA/D,CAAP;;;MAGF,OAAOnB,gBAAP;;;GAZJ;AAeD;SAEeoB,sCAAsCN;EACpD,MAAMhB,iBAAiB,GAAGiB,KAAK,CAACC,IAAN,CAAWF,OAAO,CAACO,UAAnB,EAA+BC,MAA/B,CAAsC,CAACC,GAAD,EAAMC,IAAN;IAC9DD,GAAG,CAACC,IAAI,CAACC,IAAN,CAAH,GAAiBD,IAAI,CAACE,KAAtB;IACA,OAAOH,GAAP;GAFwB,EAGvB,EAHuB,CAA1B;EAIA,MAAMI,UAAU,GAAGhC,0BAA0B,CAC3CmB,OAD2C,EAE3ChB,iBAAiB,CAACG,gBAAD,CAF0B,EAG3CH,iBAH2C,EAI3C,KAJ2C,CAA7C;EAMA,OAAO6B,UAAP;AACD;;;;"}